'use strict';

require('string-utils');
const watch = require('node-watch');
const watchers = [];
const applicationRootPath = './';
const fs = require('fs');

watch(applicationRootPath, function (filename) {
    let filePath = "/" + filename;
    fs.exists('.' + filePath, function(fileExists){
        watchers.forEach(function(watcher){
           if(typeof watcher.test === 'function' && watcher.test(filePath) && typeof watcher.handle === 'function')
           {
               watcher.handle(filePath, !fileExists);
           }
        });
    });
});

exports.addWatcher = function(watcher){
    watchers.push(watcher);
};