'use strict';

const fs = require('fs');
const logger = require('dachshund-logger').getLogger(__filename);
const AUTH_FILE_NAME = ".auth.json";

var nodeAuthorization = exports;

nodeAuthorization.load = function(resourcePath) {
	var properties = {allow: {}, deny: {}};

	var nodePropertiesPath = "." + resourcePath + "/" + AUTH_FILE_NAME;

	if (fs.existsSync(nodePropertiesPath))
	{
		var propertyFileData = fs.readFileSync(nodePropertiesPath, 'utf8');
		try
		{
			properties = JSON.parse(propertyFileData);
		} catch (err)
		{
			logger.error("Error while parsing node authorizations '" + nodePropertiesPath + "'. " + err);
		}
	}

	return properties;
};

nodeAuthorization.save = function(resourcePath, properties) {
	var nodePropertiesPath = "." + resourcePath + "/" + AUTH_FILE_NAME;
	properties.timeLastChange = new Date();

	var propertyFileData = JSON.stringify(properties);

	fs.writeFileSync(nodePropertiesPath, propertyFileData, 'utf8');
};
