'use strict';

const Q = require('q');
const javascriptHandler = exports;

javascriptHandler.extension = "js";

javascriptHandler.handle = function(component, scriptPath, parameter)
{
	let deferred = Q.defer();
	let script = null;
	try 
	{
		script = require(process.cwd() + scriptPath);

		try
		{
			if(script.handle == undefined)
			{
				deferred.reject(new Error("The script '"+ scriptPath +"' has no method handle."));
			}
			deferred.resolve(Q(script.handle(component.req, component.res, component.pathInfo, component.resource, component)));
		}
		catch(err)
		{
			deferred.reject(new Error("Error while executing script " + scriptPath + " >> " + err));
		}
	}
	catch(err)
	{
		deferred.reject(new Error("Error while including script " + scriptPath + " >> " + err));
	}

	return deferred.promise;
};
