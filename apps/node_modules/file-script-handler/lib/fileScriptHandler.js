/** file-script-handler#imageSizeHandler */
'use strict';

const fs = require("fs");
const logger = require('dachshund-logger').getLogger(__filename);

let fileScriptHandler = exports;

fileScriptHandler.getScriptHandler = function(pathInfo) {
	if (fileScriptHandler._scriptHandler === undefined)
	{
		fileScriptHandler.loadScriptHandler();
	}

	let foundScriptHandler = null;

	for (let scriptHandler of fileScriptHandler._scriptHandler)
	{
		if (scriptHandler.test && scriptHandler.test(pathInfo))
		{
			foundScriptHandler = scriptHandler;
			break;
		}
	}

	return foundScriptHandler;
};

fileScriptHandler.loadScriptHandler = function() {
	fileScriptHandler._scriptHandler = [];

	fs.readdirSync(__dirname + "/fileScriptHandler").forEach(function(file) {
		try
		{
			let scriptHandler = require("./fileScriptHandler/" + file);

			fileScriptHandler._scriptHandler.push(scriptHandler);

		} catch (err)
		{
			logger.error("Error while loading file script handler [" + file + "] because: " + err.toString());
		}
	});
};


