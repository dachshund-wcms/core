'use strict';

const logger = require('dachshund-logger').getLogger(__filename);
const repositoryWatcher = require('repository-watcher');
const bowerFileWatcher = {};
const bowerFileRegex = /^\/libs\/[^\/]+\/bower\.json/;
const exec = require('child_process').exec;


bowerFileWatcher.test = function (filePath) {
    return bowerFileRegex.test(filePath);
};

bowerFileWatcher.handle = function (filePath, fileDeleted) {
    if (!fileDeleted) {
        const bowerWorkingDirectory = process.cwd() + filePath.lastSubstringBefore('/');
        exec('bower install --no-color', {cwd: bowerWorkingDirectory}, (error, stdout, stderr) => {
            if(error || stderr)
            {
                let errorMessage = error || stderr;
                logger.error("Error while executing bowser: " + errorMessage);
            }
            else
            {
                logger.debug("Executed 'bower install' for '"+ filePath +"' with result: \n" + stdout);
            }
        });
    }
};


repositoryWatcher.addWatcher(bowerFileWatcher);


